<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Kasir Toko</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat ikon dari Lucide -->
    <script src="https://unpkg.com/lucide-react@0.368.0/dist/umd/lucide-react.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .product-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-slate-100">

    <div id="app" class="flex flex-col lg:flex-row h-screen">

        <!-- Bagian Kiri: Produk -->
        <div class="w-full lg:w-3/5 p-4 flex flex-col">
            <header class="mb-4">
                <h1 class="text-3xl font-bold text-slate-800">Toko Sejahtera</h1>
                <p class="text-slate-500">Sistem Kasir Point of Sale</p>
            </header>
            <div class="relative mb-4">
                <input type="text" id="search-product" placeholder="Cari produk atau pindai barcode..." class="w-full p-3 pl-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <svg class="w-5 h-5 text-gray-400 absolute top-3.5 left-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
            <div id="product-list" class="flex-1 overflow-y-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-2">
                <!-- Daftar produk akan dimuat di sini oleh JavaScript -->
            </div>
        </div>

        <!-- Bagian Kanan: Pesanan -->
        <div class="w-full lg:w-2/5 bg-white p-6 flex flex-col shadow-lg">
            <h2 class="text-2xl font-bold text-slate-800 mb-4 border-b pb-4">Pesanan Saat Ini</h2>
            <div id="cart-items" class="flex-1 overflow-y-auto">
                <!-- Item keranjang akan ditambahkan di sini -->
                <div id="empty-cart" class="flex flex-col items-center justify-center h-full text-slate-400">
                     <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-basket mb-4"><path d="m5 11 4-7"/><path d="m19 11-4-7"/><path d="M2 11h20"/><path d="m3.5 11 1.6 7.4a2 2 0 0 0 2 1.6h9.8c.9 0 1.8-.7 2-1.6l1.7-7.4"/><path d="m9 11 1 9"/><path d="M4.5 15.5h15"/><path d="m15 11-1 9"/></svg>
                    <p>Keranjang masih kosong</p>
                    <p class="text-sm">Pilih produk untuk memulai</p>
                </div>
            </div>
            <div class="mt-auto pt-6 border-t">
                <div class="space-y-2 text-slate-600">
                    <div class="flex justify-between">
                        <span>Subtotal</span>
                        <span id="subtotal" class="font-medium text-slate-800">Rp 0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Pajak (11%)</span>
                        <span id="tax" class="font-medium text-slate-800">Rp 0</span>
                    </div>
                    <div class="flex justify-between text-xl font-bold text-slate-900">
                        <span>Total</span>
                        <span id="total">Rp 0</span>
                    </div>
                </div>
                <button id="pay-button" class="w-full bg-blue-600 text-white py-4 rounded-lg mt-6 font-bold text-lg hover:bg-blue-700 transition duration-300 disabled:bg-slate-300 disabled:cursor-not-allowed">
                    BAYAR
                </button>
            </div>
        </div>

    </div>

    <!-- Modal Pembayaran -->
    <div id="payment-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md m-4">
            <h3 class="text-2xl font-bold mb-2 text-slate-800">Pembayaran</h3>
            <p class="text-slate-500 mb-6">Total yang harus dibayar:</p>
            <p id="modal-total" class="text-4xl font-extrabold text-blue-600 mb-6 text-center">Rp 0</p>
            
            <div class="mb-6">
                <label class="font-bold text-slate-600 mb-2 block">Metode Pembayaran</label>
                <div class="flex space-x-2">
                    <button onclick="selectPaymentMethod('cash')" id="cash-method-btn" class="payment-method-btn flex-1 p-3 border-2 border-blue-500 bg-blue-50 text-blue-700 rounded-lg font-semibold">Tunai</button>
                    <button onclick="selectPaymentMethod('digital')" id="digital-method-btn" class="payment-method-btn flex-1 p-3 border rounded-lg font-semibold text-slate-600">Kartu/QRIS</button>
                </div>
            </div>

            <div id="cash-payment-section">
                 <label for="cash-amount" class="font-bold text-slate-600 mb-2 block">Jumlah Uang Tunai</label>
                 <input type="text" id="cash-amount" placeholder="Contoh: 100000" class="w-full p-3 border rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                 <div class="flex space-x-2 mt-2">
                     <button onclick="setCashAmount(50000)" class="flex-1 bg-slate-200 p-2 rounded text-slate-700 hover:bg-slate-300">50rb</button>
                     <button onclick="setCashAmount(100000)" class="flex-1 bg-slate-200 p-2 rounded text-slate-700 hover:bg-slate-300">100rb</button>
                     <button onclick="setCashAmount(0)" class="flex-1 bg-slate-200 p-2 rounded text-slate-700 hover:bg-slate-300">Pas</button>
                 </div>
                 <div class="mt-4 text-lg">
                     <span class="text-slate-600">Kembalian:</span>
                     <span id="change-amount" class="font-bold text-green-600">Rp 0</span>
                 </div>
            </div>

            <div class="mt-8 flex flex-col space-y-3">
                <button id="process-payment-btn" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition">Proses Pembayaran</button>
                <button onclick="closePaymentModal()" class="w-full bg-slate-200 text-slate-700 py-3 rounded-lg font-bold hover:bg-slate-300 transition">Batal</button>
            </div>
        </div>
    </div>
    
    <!-- Modal Struk -->
    <div id="receipt-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-sm m-4">
             <h3 class="text-2xl font-bold mb-4 text-center text-slate-800">Transaksi Berhasil</h3>
             <div class="bg-slate-50 p-4 rounded-lg border border-dashed">
                <pre id="receipt-content" class="text-sm whitespace-pre-wrap font-mono"></pre>
             </div>
             <div class="mt-6 flex flex-col space-y-2">
                <button onclick="printReceipt()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">Cetak Struk</button>
                <button onclick="startNewTransaction()" class="w-full bg-slate-600 text-white py-3 rounded-lg font-bold hover:bg-slate-700 transition">Transaksi Baru</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA PRODUK (Bisa diganti dengan data dari database) ---
            const products = [
                { id: 1, name: 'Kopi Instan Sachet', price: 1500, barcode: '8999909012345' },
                { id: 2, name: 'Teh Celup Box', price: 5200, barcode: '8999909012352' },
                { id: 3, name: 'Mie Instan Goreng', price: 3200, barcode: '8999909012369' },
                { id: 4, name: 'Air Mineral 600ml', price: 3000, barcode: '8999909012376' },
                { id: 5, name: 'Biskuit Cokelat', price: 7500, barcode: '8999909012383' },
                { id: 6, name: 'Susu UHT 250ml', price: 6000, barcode: '8999909012390' },
                { id: 7, name: 'Deterjen Bubuk 800g', price: 18500, barcode: '8999909012406' },
                { id: 8, name: 'Sabun Mandi Batang', price: 4000, barcode: '8999909012413' },
                { id: 9, name: 'Shampo Botol 170ml', price: 16000, barcode: '8999909012420' },
                { id: 10, name: 'Minyak Goreng 1L', price: 25000, barcode: '8999909012437' },
                { id: 11, name: 'Gula Pasir 1kg', price: 14500, barcode: '8999909012444' },
                { id: 12, name: 'Roti Tawar', price: 12000, barcode: '8999909012451' },
            ];

            // --- STATE APLIKASI ---
            let cart = [];
            let currentPaymentMethod = 'cash';
            let totalAmount = 0;

            // --- ELEMEN DOM ---
            const productListEl = document.getElementById('product-list');
            const cartItemsEl = document.getElementById('cart-items');
            const subtotalEl = document.getElementById('subtotal');
            const taxEl = document.getElementById('tax');
            const totalEl = document.getElementById('total');
            const payButton = document.getElementById('pay-button');
            const searchInput = document.getElementById('search-product');
            const emptyCartEl = document.getElementById('empty-cart');
            
            // Modal Pembayaran
            const paymentModal = document.getElementById('payment-modal');
            const modalTotalEl = document.getElementById('modal-total');
            const cashAmountInput = document.getElementById('cash-amount');
            const changeAmountEl = document.getElementById('change-amount');
            const processPaymentBtn = document.getElementById('process-payment-btn');

            // Modal Struk
            const receiptModal = document.getElementById('receipt-modal');
            const receiptContentEl = document.getElementById('receipt-content');

            // --- FUNGSI ---
            
            // Format angka menjadi format Rupiah
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);
            };

            // Render daftar produk
            const renderProducts = (productsToRender = products) => {
                productListEl.innerHTML = '';
                if(productsToRender.length === 0) {
                    productListEl.innerHTML = `<p class="text-slate-500 col-span-full text-center">Produk tidak ditemukan.</p>`;
                    return;
                }
                productsToRender.forEach(product => {
                    const productCard = `
                        <div class="product-card bg-white p-4 rounded-lg shadow cursor-pointer border" onclick="app.addToCart(${product.id})">
                            <h3 class="font-bold text-slate-800 truncate">${product.name}</h3>
                            <p class="text-slate-500">${formatCurrency(product.price)}</p>
                        </div>
                    `;
                    productListEl.innerHTML += productCard;
                });
            };

            // Render item di keranjang
            const renderCart = () => {
                cartItemsEl.innerHTML = '';
                if (cart.length === 0) {
                    emptyCartEl.classList.remove('hidden');
                } else {
                    emptyCartEl.classList.add('hidden');
                    cart.forEach(item => {
                        const cartItem = `
                            <div class="flex items-center justify-between mb-4 p-2 rounded-lg bg-slate-50">
                                <div>
                                    <p class="font-bold text-slate-800">${item.name}</p>
                                    <p class="text-sm text-slate-500">${formatCurrency(item.price)}</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <button class="bg-slate-200 w-7 h-7 rounded-full font-bold hover:bg-slate-300" onclick="app.updateQuantity(${item.id}, -1)">-</button>
                                    <span class="w-8 text-center font-medium">${item.quantity}</span>
                                    <button class="bg-slate-200 w-7 h-7 rounded-full font-bold hover:bg-slate-300" onclick="app.updateQuantity(${item.id}, 1)">+</button>
                                    <button class="text-red-500 hover:text-red-700" onclick="app.removeFromCart(${item.id})">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                    </button>
                                </div>
                            </div>
                        `;
                        cartItemsEl.innerHTML += cartItem;
                    });
                }
                updateSummary();
            };

            // Update ringkasan total belanja
            const updateSummary = () => {
                const subtotal = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
                const tax = subtotal * 0.11;
                totalAmount = subtotal + tax;

                subtotalEl.textContent = formatCurrency(subtotal);
                taxEl.textContent = formatCurrency(tax);
                totalEl.textContent = formatCurrency(totalAmount);

                payButton.disabled = cart.length === 0;
            };

            // Menambahkan produk ke keranjang
            window.app.addToCart = (productId) => {
                const product = products.find(p => p.id === productId);
                const cartItem = cart.find(item => item.id === productId);

                if (cartItem) {
                    cartItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                renderCart();
            };
            
            // Mengubah jumlah produk di keranjang
            window.app.updateQuantity = (productId, change) => {
                const cartItem = cart.find(item => item.id === productId);
                if (cartItem) {
                    cartItem.quantity += change;
                    if (cartItem.quantity <= 0) {
                        app.removeFromCart(productId);
                    }
                }
                renderCart();
            };

            // Menghapus produk dari keranjang
            window.app.removeFromCart = (productId) => {
                cart = cart.filter(item => item.id !== productId);
                renderCart();
            };
            
            // Pencarian produk
            const handleSearch = (e) => {
                const searchTerm = e.target.value.toLowerCase();
                if(searchTerm.length > 12) { // Barcode scan detected
                    const product = products.find(p => p.barcode === searchTerm);
                    if(product) {
                        app.addToCart(product.id);
                        e.target.value = ''; // clear input after scan
                        renderProducts();
                    }
                    return;
                }
                const filteredProducts = products.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) ||
                    p.barcode.includes(searchTerm)
                );
                renderProducts(filteredProducts);
            };

            // Logika pembayaran
            const openPaymentModal = () => {
                modalTotalEl.textContent = formatCurrency(totalAmount);
                paymentModal.classList.remove('hidden');
                selectPaymentMethod('cash');
                cashAmountInput.value = '';
                updateChange();
            };
            
            window.closePaymentModal = () => {
                paymentModal.classList.add('hidden');
            };

            window.selectPaymentMethod = (method) => {
                currentPaymentMethod = method;
                const cashSection = document.getElementById('cash-payment-section');
                const cashBtn = document.getElementById('cash-method-btn');
                const digitalBtn = document.getElementById('digital-method-btn');
                
                if(method === 'cash') {
                    cashSection.style.display = 'block';
                    cashBtn.classList.add('border-blue-500', 'bg-blue-50', 'text-blue-700');
                    cashBtn.classList.remove('text-slate-600');
                    digitalBtn.classList.remove('border-blue-500', 'bg-blue-50', 'text-blue-700');
                    digitalBtn.classList.add('text-slate-600');
                    processPaymentBtn.disabled = true;
                } else {
                    cashSection.style.display = 'none';
                    digitalBtn.classList.add('border-blue-500', 'bg-blue-50', 'text-blue-700');
                    digitalBtn.classList.remove('text-slate-600');
                    cashBtn.classList.remove('border-blue-500', 'bg-blue-50', 'text-blue-700');
                    cashBtn.classList.add('text-slate-600');
                    processPaymentBtn.disabled = false;
                }
            };
            
            const updateChange = () => {
                const cashAmount = parseFloat(cashAmountInput.value.replace(/[^0-9]/g, '')) || 0;
                let change = cashAmount - totalAmount;
                if(change < 0) change = 0;
                
                changeAmountEl.textContent = formatCurrency(change);
                
                if (cashAmount >= totalAmount) {
                     processPaymentBtn.disabled = false;
                } else {
                     processPaymentBtn.disabled = true;
                }
            };

            cashAmountInput.addEventListener('input', (e) => {
                // Format input to have thousand separators
                let value = e.target.value.replace(/[^0-9]/g, '');
                e.target.value = value ? parseInt(value, 10).toLocaleString('id-ID') : '';
                updateChange();
            });

            window.setCashAmount = (amount) => {
                 if (amount === 0) { // Uang Pas
                     cashAmountInput.value = Math.ceil(totalAmount).toLocaleString('id-ID');
                 } else {
                     cashAmountInput.value = amount.toLocaleString('id-ID');
                 }
                 updateChange();
            }

            const processPayment = () => {
                generateReceipt();
                closePaymentModal();
                receiptModal.classList.remove('hidden');
            }

            const generateReceipt = () => {
                const now = new Date();
                let receipt = '';
                receipt += 'TOKO SEJAHTERA\n';
                receipt += 'Jl. Pembangunan No. 123\n';
                receipt += '--------------------------------\n';
                receipt += `Kasir: Admin\n`;
                receipt += `Waktu: ${now.toLocaleDateString('id-ID')} ${now.toLocaleTimeString('id-ID')}\n`;
                receipt += '--------------------------------\n';
                cart.forEach(item => {
                    const itemTotal = formatCurrency(item.quantity * item.price);
                    const itemName = item.name.padEnd(20, ' ');
                    receipt += `${itemName}\n`;
                    receipt += `  ${item.quantity} x ${formatCurrency(item.price).padEnd(10)} ${itemTotal.padStart(10)}\n`;
                });
                receipt += '--------------------------------\n';
                receipt += `Subtotal: ${subtotalEl.textContent.padStart(20)}\n`;
                receipt += `Pajak(11%): ${taxEl.textContent.padStart(18)}\n`;
                receipt += `Total:    ${totalEl.textContent.padStart(20)}\n`;
                receipt += '--------------------------------\n';
                
                const cashGiven = parseFloat(cashAmountInput.value.replace(/[^0-9]/g, '')) || totalAmount;
                
                if(currentPaymentMethod === 'cash') {
                    receipt += `Tunai:    ${formatCurrency(cashGiven).padStart(20)}\n`;
                    receipt += `Kembali:  ${changeAmountEl.textContent.padStart(20)}\n`;
                } else {
                    receipt += `Metode:   ${'Kartu/QRIS'.padStart(20)}\n`;
                }

                receipt += '\nTerima kasih telah berbelanja!\n';
                receiptContentEl.textContent = receipt;
            }

            window.printReceipt = () => {
                const receiptWindow = window.open('', 'PRINT', 'height=600,width=400');
                receiptWindow.document.write('<html><head><title>Struk Belanja</title>');
                receiptWindow.document.write('<style>body { font-family: monospace; font-size: 12px; } pre { white-space: pre-wrap; }</style>');
                receiptWindow.document.write('</head><body>');
                receiptWindow.document.write(`<pre>${receiptContentEl.textContent}</pre>`);
                receiptWindow.document.write('</body></html>');
                receiptWindow.document.close();
                receiptWindow.focus();
                receiptWindow.print();
                receiptWindow.close();
            }
            
            window.startNewTransaction = () => {
                cart = [];
                receiptModal.classList.add('hidden');
                renderCart();
            }

            // --- INISIALISASI ---
            window.app = { ...window.app, addToCart, updateQuantity, removeFromCart };
            renderProducts();
            renderCart();

            // --- EVENT LISTENERS ---
            searchInput.addEventListener('keyup', handleSearch);
            payButton.addEventListener('click', openPaymentModal);
            processPaymentBtn.addEventListener('click', processPayment);
        });
    </script>
</body>
</html>
